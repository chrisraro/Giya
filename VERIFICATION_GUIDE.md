# Giya App - Deployment Verification Guide

This guide explains how to verify that the deployment was successful and that all the fixes for reward redemption issues are working correctly.

## Prerequisites

1. Database schema updates have been applied (script [008_fix_redemptions_schema.sql](file:///c%3A/Users/User/OneDrive/Desktop/giya/scripts/008_fix_redemptions_schema.sql))
2. Code changes have been pushed to GitHub
3. Vercel deployment has completed successfully

## Verification Steps

### 1. Check Vercel Deployment

1. Go to your Vercel dashboard
2. Navigate to the Giya project
3. Check the "Deployments" tab to ensure the latest deployment was successful
4. Click on the latest deployment to view logs and confirm there were no build errors

### 2. Verify Database Schema Updates

1. Go to your Supabase project dashboard
2. Navigate to the Table Editor
3. Check that the `redemptions` table has all the following columns:
   - `reward_id` (uuid, references rewards.id)
   - `points_redeemed` (integer)
   - `redemption_qr_code` (text, unique)
   - `validated_at` (timestamp with time zone)
   - `validated_by` (uuid, references businesses.id)
   - `customer_id` (uuid, references customers.id)
   - `business_id` (uuid, references businesses.id)
4. Verify that the `reward_redemptions` table no longer exists
5. Check that the `deduct_points_on_redemption` function exists and is properly configured

### 3. Test Reward Redemption Flow

#### As a Customer:

1. Log in to the app as a customer
2. Navigate to the "Rewards" page (`/dashboard/customer/rewards`)
3. Find a reward you have enough points to redeem
4. Click "Redeem Now" and confirm the redemption
5. Verify that:
   - Points are immediately deducted from your total
   - A QR code is generated and displayed
   - The redemption appears in your redemption history

#### As a Business:

1. Log in to the app as a business
2. Navigate to the "Validate Redemption" page (`/dashboard/business/validate-redemption`)
3. Click "Open Scanner" and scan the QR code generated by the customer
4. Verify that:
   - The redemption details are displayed correctly
   - You can validate the redemption
   - After validation, the redemption status updates correctly

### 4. Check Point Deductions

1. As a customer, check your total points in the dashboard
2. Redeem a reward and confirm the points are deducted
3. Check that the `total_points` field in the `customers` table is updated correctly

### 5. Verify Redemption History Display

#### Customer Side:

1. Log in as a customer
2. Navigate to your dashboard
3. Check the "Redemption History" tab
4. Verify that all your redemptions are displayed with correct details:
   - Reward name
   - Points redeemed
   - Status
   - Date

#### Business Side:

1. Log in as a business
2. Check that validated redemptions appear in your transaction history

### 6. Test QR Code Scanning

1. As a business, go to the "Validate Redemption" page
2. Try scanning a valid redemption QR code
3. Verify that invalid or expired QR codes are properly rejected with appropriate error messages

## Common Issues and Troubleshooting

### Points Not Deducting

1. Check that the `deduct_points_on_redemption` function exists in Supabase
2. Verify that the trigger is active on the `redemptions` table
3. Check the function logic to ensure it's properly retrieving reward points

### QR Code Not Scanning

1. Verify that the QR code contains the correct redemption ID
2. Check that the redemption record exists in the database
3. Ensure the business is associated with the correct business_id

### Redemption History Not Showing

1. Check that queries are using `customer_id` rather than `user_id`
2. Verify that the redemption status is properly set
3. Confirm RLS policies allow customers to view their own redemptions

### Database Errors

1. Ensure all SQL scripts have been run in the correct order
2. Check that foreign key relationships are properly established
3. Verify that all required columns exist in the tables

## Success Criteria

The deployment is successful if all of the following criteria are met:

1. ✅ Vercel deployment completes without errors
2. ✅ Database schema updates are applied correctly
3. ✅ Customers can redeem rewards and have points deducted immediately
4. ✅ QR codes are generated for redemptions
5. ✅ Businesses can scan and validate redemption QR codes
6. ✅ Redemption history displays correctly for both customers and businesses
7. ✅ All existing functionality continues to work as expected

## Rollback Plan

If issues are discovered after deployment:

1. Revert the frontend code to the previous version:
   ```bash
   git revert HEAD
   git push origin main
   ```
2. If database issues are found, restore from a backup if available
3. Contact the development team for further assistance

## Support

For additional support, refer to:
- [PROJECT_DOCUMENTATION.md](file:///c%3A/Users/User/OneDrive/Desktop/giya/PROJECT_DOCUMENTATION.md)
- [TROUBLESHOOTING_GUIDE.md](file:///c%3A/Users/User/OneDrive/Desktop/giya/TROUBLESHOOTING_GUIDE.md)
- [DEPLOYMENT_GUIDE.md](file:///c%3A/Users/User/OneDrive/Desktop/giya/DEPLOYMENT_GUIDE.md)